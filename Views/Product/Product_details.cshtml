@model  Website_BDS.Models.ViewModel.ProductDetailViewModel
@{
    Layout = "~/Views/Shared/_LayoutPageHome.cshtml";
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Product_Details</title>
    <link rel="stylesheet" href="~/Font-end/asset/base.css" />
    <link rel="stylesheet" href="~/Font-end/css/style-Product-Details.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />

    <!-- Script -->
    <script>
        function openMap() {
            window.open(
                "https://www.google.com/maps/search/?api=1&query=Landmark+81+Ho+Chi+Minh",
                "_blank"
            );
        }
    </script>
</head>
<body>
    <div class="product-page">
        <div class="product-info">
            <div class="Image-details">
                <img src="./asset/icon/Product_Null.jpg"
                     alt="image-product"
                     height="300"
                     width="300" />
            </div>
            <div class="Infomation-detailt-product">
                <div class="save">
                    <button class="button_small @(ViewBag.IsSaved == true ? "active-yellow" : "")"
                            onclick="ToggleSave(@Model.Product.ProductID, this)">
                        <i class="fa-solid fa-heart"></i> Lưu tin
                    </button>
                </div>
                <div class="listing-overview">
                    <h1>@Model.Product.Title</h1>
                    <h3>Price : <strong>@Model.Product.Price</strong> VNĐ</h3>
                    <h3>Địa chỉ: @Model.Product.Address</h3>
                </div>
                <div class="Contact">Thông tin mô tả</div>
                <div class="information-base">
                    <div class="utility">
                        <h1>Thông tin cơ bản</h1>
                        <div>
                            <p><i class="fa-solid fa-shapes"></i> Loại hình bất động sản: @Model.Product.Type</p>
                            <p><i class="fa-solid fa-chart-area"></i> Diện tích: @Model.Product.Area</p>
                        </div>
                        <div>
                            <p><i class="fa-solid fa-bed"></i> Số phòng ngủ: @Model.Product.Bedrooms</p>
                            <p><i class="fa-solid fa-bath"></i> Số phòng vệ sinh: @Model.Product.Bathrooms </p>
                        </div>
                        <div class="action-button">
                            <button class="button_small"><i class="fa-solid fa-heart"></i> Lưu</button>

                            <button class="button_small"><i class="fa-solid fa-share"></i> Chia sẻ</button>
                            <button class="button_small"><i class="fa-solid fa-circle-exclamation"></i> Báo vi phạm</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="user-info">
            <div class="product-user-infomation_details">
                <div class="User">
                    <span id="Avatar-User">
                        <img src="@Url.Content(
                        string.IsNullOrEmpty(Model?.Seller?.Avatar_User)
                            ? "~/Font-end/asset/icon/User-default.jpg"
                            : "~/Content/" + Model.Seller.Avatar_User
                        )" alt="Avatar" style="width:70px; height:70px; border-radius:50%; object-fit:cover;" />
                    </span>
                    <button class="button_small">Xem trang</button>
                </div>

                <div class="contact">
                    <button class="button_small">Liên hệ số điện thoại</button>
                    <button class="button_small">Liên hệ zalo</button>
                </div>
            </div>
            <div class="comment-section">
                <h4>Bình luận</h4>
                <div class="Area-comment">
                    <textarea placeholder="Bình Luận..." class="Comment"></textarea>
                    <button class="button_small">
                        <i class="fa-solid fa-paper-plane"></i>
                        Gửi
                    </button>
                </div>
            </div>
            <div class="mini-map" onclick="openMap()">
                <iframe width= "100%"
                        height="200"
                        style="border: 0; pointer-events: none"
                        src="https://www.google.com/maps?q=10.7950,106.7200&z=15&output=embed">
                </iframe>
            </div>
        </div>
    </div>

    <h2 class="section-title" style="text-align: center">
        Các Mẫu mà Bạn có thể quan tâm đến
    </h2>
    <div class="listing-section">
        <div class="product-listings">
            <div class="product-card">
                <!-- Nội dung sản phẩm -->
                <button class="btn-view">Xem chi tiết</button>
                <button class="btn-save">Lưu tin</button>
            </div>
            <!-- Các thẻ khác -->
        </div>
        <aside class="filter-panel">
            <!-- Bộ lọc tìm kiếm -->
            <div class="search-box">
                <input type="hidden" id="transaction-type" name="TransactionType" value="Bán">

                <div class="tabs">
                    <button class="tab active" onclick="updateType('Bán')">Bán</button>
                    <button class="tab" onclick="updateType('Mua')">Mua</button>
                </div>

            </div>

            <script>
                // Hàm xử lý giao diện active
                const tabs = document.querySelectorAll('.search-box .tab');
                tabs.forEach(tab => {
                    tab.addEventListener('click', function (e) {
                        e.preventDefault();
                        tabs.forEach(t => t.classList.remove('active'));
                        this.classList.add('active');
                    });
                });

                // Hàm cập nhật giá trị vào input ẩn để gửi về server
                function updateType(type) {
                    document.getElementById('transaction-type').value = type;
                }
            </script>

            <div class="form">
                <select>
                    <option>Từ khóa</option>
                </select>
                <select>
                    <option>Chọn loại đất</option>
                </select>
                <select>
                    <option>Tỉnh thành, quận huyện</option>
                </select>
                <select>
                    <option>Phường, xã</option>
                </select>

                <div class="price-row">
                    <select>
                        <option>Giá thấp nhất</option>
                    </select>
                    <select>
                        <option>Giá cao nhất</option>
                    </select>
                </div>

                <button class="btn-search">Tìm kiếm</button>
            </div>
    </div>
    </aside>
    </div>

</body>

</html>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

<script>
    function ToggleSave(productId, btnElement) {
        $.ajax({
            
            url: '@Url.Action("ToggleSaveProduct", "Users")',
            type: 'POST',
            data: { productId: productId },
            success: function (response) {
                if (response.success) {
                    if (response.isSaved) {
                        $(btnElement).addClass('active-yellow');
                        // $(btnElement).html('<i class="fa-solid fa-heart"></i> Đã lưu');
                        alert("Đã lưu tin thành công!");
                    } else {
                        $(btnElement).removeClass('active-yellow');
                        // $(btnElement).html('<i class="fa-solid fa-heart"></i> Lưu tin');
                        alert("Đã bỏ lưu tin!");
                    }
                } else {
                    // In ra message cụ thể từ server (ví dụ: chưa đăng nhập)
                    alert(response.message);
                }
            },
            error: function (xhr, status, error) {
                // In lỗi chi tiết ra console của trình duyệt (F12 -> Console)
                console.error("Lỗi:", error);
                console.log("Chi tiết:", xhr.responseText);

                alert("Có lỗi kết nối: " + xhr.status + " " + xhr.statusText + ". Vui lòng kiểm tra Console (F12) để biết chi tiết.");
            }
        });
    }
</script>