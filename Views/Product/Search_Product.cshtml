@model List<Website_BDS.Models.Product>
@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewBag.Title = "Tìm kiếm sản phẩm";
}

<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>@ViewBag.Title</title>
    <link rel="stylesheet" href="~/Font-end/asset/base.css" />
    @*<link rel="stylesheet" href="~/Font-end/asset/style.css" />*@
    <link rel="stylesheet" href="~/Font-end/CSS/style-Search_Products.css" />

    <script defer src="~/Scripts/Scripts-fontend/Script-Search_Products.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script defer src="~/Scripts/Scripts-fontend/API-Address-Selector.js"></script>
</head>
<body>

    

    <div class="main-container">
        <div class="section-header">
            <h2>Bất động sản nổi bật</h2>
            <a href="#" class="view-all">Xem tất cả <i class="fa-solid fa-arrow-right"></i></a>
        </div>

        <div class="product-grid">
            @if (Model != null && Model.Any())
            {
                foreach (var item in Model)
                {
                    <div class="product-card">
                        <div class="card-thumb">
                            @{
                                string rawImg = item.PropertyImages.FirstOrDefault(x => x.IsPrimary == true)?.ImageUrl
                                                ?? item.PropertyImages.FirstOrDefault()?.ImageUrl
                                                ?? "~/Font-end/asset/icon/Product_Null.jpg";
                                string displayImg = (!rawImg.StartsWith("http") && !rawImg.StartsWith("/")) ? Url.Content(rawImg) : rawImg;
                            }
                            <img src="@displayImg" alt="@item.Title" onerror="this.src='@Url.Content("~/Font-end/asset/icon/Product_Null.jpg")'" />

                            <div class="card-badges">
                                <span class="badge badge-type">@item.ListingType</span> <span class="badge badge-hot">Nổi bật</span>
                            </div>
                            <button class="btn-heart"><i class="fa-regular fa-heart"></i></button>
                        </div>

                        <div class="card-body">
                            <div class="card-price">@string.Format("{0:N0}", item.Price) VNĐ</div>
                            <h3 class="card-title">
                                <a href="@Url.Action("Product_details", "Product", new { id = item.ProductID })">@item.Title</a>
                            </h3>
                            <p class="card-address"><i class="fa-solid fa-location-dot"></i> @item.Address</p>

                            <div class="card-specs">
                                <span><i class="fa-solid fa-bed"></i> 3 PN</span>
                                <span><i class="fa-solid fa-bath"></i> 2 WC</span>
                                <span><i class="fa-solid fa-ruler-combined"></i> 100m²</span>
                            </div>
                        </div>

                        <div class="card-footer">
                            <span class="agent-type">Nhà riêng</span>
                            <a href="@Url.Action("Product_details", "Product", new { id = item.ProductID })" class="btn-detail">Chi tiết</a>
                        </div>
                    </div>
                }
            }
            else
            {
                <div class="no-data">
                    <img src="~/Font-end/asset/icon/no-data.png" alt="No Data" width="100" />
                    <p>Chưa tìm thấy bất động sản nào phù hợp.</p>
                </div>
            }
        </div>
    </div>

    <script>
        var citis = document.getElementById("city");
        var districts = document.getElementById("district");
        var wards = document.getElementById("ward");
        var Parameter = {
            url: "https://raw.githubusercontent.com/kenzouno1/DiaGioiHanhChinhVN/master/data.json",
            method: "GET",
            responseType: "application/json",
        };
        var promise = axios(Parameter);
        promise.then(function (result) {
            renderCity(result.data);
        });
        function renderCity(data) {
            for (const x of data) {
                citis.options[citis.options.length] = new Option(x.Name, x.Name);
            }
            citis.onchange = function () {
                districts.length = 1;
                wards.length = 1;
                if (this.value != "") {
                    const result = data.filter(n => n.Name === this.value);
                    for (const k of result[0].Districts) {
                        districts.options[districts.options.length] = new Option(k.Name, k.Name);
                    }
                }
            };
        }
    </script>
</body>
</html>
